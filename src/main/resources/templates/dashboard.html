<!DOCTYPE html>
<html lang="es" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="../static/layouts/layout :: head">
  <title>Books</title>
</head>
<body id="bookListPage">
<nav th:replace="../static/layouts/layout :: navbar"></nav>
<div class="container-fluid mt-5 mb-5">
  <div class="row d-flex  justify-content-center m-2" style="min-height: 30rem;">

    <div th:if="${success != null}"  class="alert alert-success alert-dismissible fade show mt-2 mb-2" role="alert">
      <i class="fas fa-check-circle"></i>
      <strong>Resultado de la solicitud</strong> [[${success}]]
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

      <div class="col-9">
      <div class="alert alert-secondary" role="alert" th:if="${loansExpired.isEmpty() && loansExpiredNow.isEmpty() && loansExpiredInTheNextWeek.isEmpty()}">
        <h5>Todavía no hay préstamos cargados.<a th:href="@{/loans/create}">Ingresar préstamo.</a></h5>
      </div>

      <h5 th:unless="${loansExpired.isEmpty()}">Prestamos vencidos</h5><hr th:unless="${loansExpired.isEmpty()}">
      <div th:unless="${loansExpired.isEmpty()}" class="row row-cols-md-6">
        <div class="col-md-3 mb-2 mr-1" th:each="loan : ${loansExpired}" >

            <div  class="card" style="max-width: 24rem;">
              <div  class="card-header border-danger"><i style="color: #DC3545;" class="fas fa-circle fa-sm"></i>  [[${loan.id}]]</div>
              <div class="card-body">
                <h5 class="card-title me-2" th:text="${loan.book.title}" style="display: inline-block;font-size: 16px;" ></h5><a th:href="@{/books/__${loan.book.isbn}__}" class="buttonBook" ><i class="far fa-eye"></i></a></br>
                <h6  th:text="${loan.customer.lastName}+', '+${loan.customer.name}" style="display: inline-block; color: #BABFC4;font-size: 14px;" class="me-2"></h6><a th:href="@{/customers/__${loan.customer.id}__}" class="buttonBook"><i class="far fa-eye fa-sm"></i></a>
                <p class="card-text" th:text="${#temporals.format(loan.loanDate,'dd/MM/yyyy')}+' - '+${#temporals.format(loan.returnDate,'dd/MM/yyyy')}" style="font-weight: 700;color: #9EC5FE;font-size: 12px;"></p>
                <a th:href="@{/loans/update/__${loan.id}__}" class="buttonBook"><i class="fas fa-pen fa-sm"></i></a>
                <a th:href="${loan.discharged == true} ? @{/loans/delete/__${loan.id}__}:@{/loans/discharge/__${loan.id}__}" class="buttonBook"><i th:classappend="${loan.discharged == true} ? 'far fa-square fa-sm' : 'far fa-check-square fa-sm'" class=""></i> Devuelto</a>
              </div>
            </div>

          </div>

        </div>

    <h5 th:unless="${loansExpiredNow.isEmpty()}">Vencen hoy</h5><hr th:unless="${loansExpiredNow.isEmpty()}">
    <div th:unless="${loansExpiredNow.isEmpty()}" class="row row-cols-md-6">
      <div class="col-md-3 mb-2 mr-1" th:each="loan : ${loansExpiredNow}">

        <div  class="card" style="max-width: 24rem;">
          <div  class="card-header border-warning" ><i class="fas fa-circle fa-sm" style="color: #FFC107;"></i>  [[${loan.id}]]</div>
          <div class="card-body">
            <h5 class="card-title me-2" th:text="${loan.book.title}" style="display: inline-block;font-size: 16px;" ></h5><a th:href="@{/books/__${loan.book.isbn}__}" class="buttonBook" ><i class="far fa-eye"></i></a></br>
            <h6  th:text="${loan.customer.lastName}+', '+${loan.customer.name}" style="display: inline-block; color: #BABFC4;font-size: 14px;" class="me-2"></h6><a th:href="@{/customers/__${loan.customer.id}__}" class="buttonBook"><i class="far fa-eye fa-sm"></i></a>
            <p class="card-text" th:text="${#temporals.format(loan.loanDate,'dd/MM/yyyy')}+' - '+${#temporals.format(loan.returnDate,'dd/MM/yyyy')}" style="font-weight: 700;color: #9EC5FE;font-size: 12px;"></p>
            <a th:href="@{/loans/update/__${loan.id}__}" class="buttonBook"><i class="fas fa-pen fa-sm"></i></a>
            <a th:href="${loan.discharged == true} ? @{/loans/delete/__${loan.id}__}:@{/loans/discharge/__${loan.id}__}" class="buttonBook"><i th:classappend="${loan.discharged == true} ? 'far fa-square fa-sm' : 'far fa-check-square fa-sm'" class=""></i> Devuelto</a>
          </div>
        </div>

      </div>

    </div>


    <h5 th:unless="${loansExpiredInTheNextWeek.isEmpty()}">Próximos vencimientos</h5><hr th:unless="${loansExpiredInTheNextWeek.isEmpty()}">
    <div th:unless="${loansExpiredInTheNextWeek.isEmpty()}" class="row row-cols-md-6">
      <div class="col-md-3 mb-2 mr-1" th:each="loan : ${loansExpiredInTheNextWeek}">

        <div  class="card" style="max-width: 24rem;">
          <div  class="card-header border-success" ><i class="fas fa-circle fa-sm" style="color: #198754;"></i>  [[${loan.id}]]</div>
          <div class="card-body">
            <h5 class="card-title me-2" th:text="${loan.book.title}" style="display: inline-block;font-size: 16px;" ></h5><a th:href="@{/books/__${loan.book.isbn}__}" class="buttonBook" ><i class="far fa-eye"></i></a></br>
            <h6  th:text="${loan.customer.lastName}+', '+${loan.customer.name}" style="display: inline-block; color: #BABFC4;font-size: 14px;" class="me-2"></h6><a th:href="@{/customers/__${loan.customer.id}__}" class="buttonBook"><i class="far fa-eye fa-sm"></i></a>
            <p class="card-text" th:text="${#temporals.format(loan.loanDate,'dd/MM/yyyy')}+' - '+${#temporals.format(loan.returnDate,'dd/MM/yyyy')}" style="font-weight: 700;color: #9EC5FE;font-size: 12px;"></p>
            <a th:href="@{/loans/update/__${loan.id}__}" class="buttonBook"><i class="fas fa-pen fa-sm"></i></a>
            <a th:href="${loan.discharged == true} ? @{/loans/delete/__${loan.id}__}:@{/loans/discharge/__${loan.id}__}" class="buttonBook"><i th:classappend="${loan.discharged == true} ? 'far fa-square fa-sm' : 'far fa-check-square fa-sm'" class=""></i> Devuelto</a>
          </div>
        </div>

      </div>

    </div>
      </div>

    <div class="col-3 mr-0" style="background-color: white; border-radius: 10px;">

      <form class="m-3" method="GET" action="/loans">
        <div class="row">
          <p>Buscar por fecha de vencimiento </p>
          <div class="col-6">
            <label class="col-sm-2 col-form-label col-form-label-sm">Desde </label><input class="form-control form-control-sm" type="date" th:name="fromDate" th:value="${fromDate}" required>
          </div>
          <div class="col-6">
            <label class="col-sm-2 col-form-label col-form-label-sm">Hasta </label><input class="form-control form-control-sm" type="date" th:name="toDate"  th:value="${toDate}" required>
          </div>
          <button class="btn btn-secondary mt-2" type="submit">Buscar</button>
        </div>
      </form>


      <form class="m-3" method="GET" action="/loans">
        <div class="row">
          <label for="#book" class="col-form-label col-form-label-sm">Buscar por libro </label></br>
          <select name="bookIsbn" id="book" class="form-control form-control-sm">
            <option th:each="book : ${books}"
                    th:value="${book.isbn}"
                    th:text="${book.title}">
            </option>
          </select>
          <button class="btn btn-secondary mt-3" type="submit">Buscar</button>
        </div>
      </form>

      <form class="m-3" method="GET" action="/loans">
        <div class="row">
          <label for="#customer" class="col-form-label col-form-label-sm">Buscar por cliente </label></br>
          <select name="customerId" id="customer" class="form-control form-control-sm">
            <option th:each="customer : ${customers}"
                    th:value="${customer.id}"
                    th:text="${customer.lastName}+', '+${customer.name}">

            </option>
          </select>
          <button class="btn btn-secondary mt-3" type="submit">Buscar</button>
        </div>
      </form>

      <!--
      <form class=" mt-3 mb-3" method="GET">
        <label for="#autor">Buscar por autor </label></br>
        <select name="author" id="autor" >
          <option ></option>
        </select>
        <button class="btn btn-primary" type="submit">Buscar</button>
      </form>-->
      <div class="row m-3 justify-content-center">
        <a class="btn btn-secondary mt-3" href="/loans/all">Clean</a>
      </div>

    </div>

  </div>
</div>
<footer th:replace="../static/layouts/layout :: footer"></footer>
</body>
</html>